import React from 'react'
import { useEffect } from 'react'
import { useDispatch, useSelector } from 'react-redux'
import { fetchMe } from '../store/slices/authSlice'
import api from '../lib_api'
export default function Profile(){ const d=useDispatch(); const user=useSelector(s=>s.auth.user); const [orders,setOrders]=React.useState([]); useEffect(()=>{ d(fetchMe()) },[d]); useEffect(()=>{ (async()=>{ try{ const {data}=await api.get('/orders'); setOrders(data) }catch{} })() },[]); if(!user) return null; return (<div className='grid md:grid-cols-3 gap-6'><div className='card'><h2 className='text-xl font-bold mb-2'>Your Profile</h2><p className='text-sm text-gray-600'>{user.name}</p><p className='text-sm text-gray-600'>{user.email}</p><p className='text-xs text-gray-400 mt-2'>Role: {user.role}</p></div><div className='md:col-span-2 card'><h2 className='text-xl font-bold mb-4'>Your Orders</h2>{orders.length===0? <p>No orders yet.</p> : (<div className='space-y-4'>{orders.map(o=>(<div key={o.id} className='border rounded p-3'><div className='flex items-center justify-between text-sm'><span className='font-medium'>#{o.id}</span><span>{o.status}</span></div><ul className='mt-2 text-sm list-disc pl-5'>{o.items.map((i,idx)=>(<li key={idx}>{i.title} × {i.qty} — ${(i.qty*i.price).toFixed(2)}</li>))}</ul><div className='text-right font-bold mt-2'>${o.amount.toFixed(2)}</div></div>))}</div>)}</div></div>) }
