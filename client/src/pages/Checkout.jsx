import { useSelector, useDispatch } from 'react-redux'
import api from '../lib_api'
import { clearCart } from '../store/slices/cartSlice'
import { useState } from 'react'
export default function Checkout(){ const items=useSelector(s=>s.cart.items); const [status,setStatus]=useState(null); const subtotal=items.reduce((a,c)=>a+c.price*c.qty,0); const d=useDispatch(); const placeOrder=async()=>{ try{ const {data}=await api.post('/orders',{ items: items.map(i=>({productId:i.id, title:i.title, qty:i.qty, price:i.price})), amount: subtotal }); setStatus(`Order ${data.id} placed! Status: ${data.status}`); d(clearCart()) }catch{ setStatus('Failed to place order. Please login.') } }; return (<div className='card max-w-xl mx-auto'><h2 className='text-xl font-bold mb-4'>Checkout</h2><p className='text-sm text-gray-600 mb-4'>No real payment is processed (demo).</p><div className='space-y-2'>{items.map(i=>(<div key={i.id} className='flex justify-between'><span>{i.title} Ã— {i.qty}</span><span>${(i.qty*i.price).toFixed(2)}</span></div>))}</div><div className='flex justify-between border-t mt-4 pt-4'><span className='font-bold'>Total</span><span className='text-lg font-black'>${subtotal.toFixed(2)}</span></div><button className='btn btn-primary w-full mt-6' onClick={placeOrder}>Place Order</button>{status && <p className='mt-3 text-sm'>{status}</p>}</div>) }
